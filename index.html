<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/site.css">
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="js/html5-qrcode.min.js"></script>
    </head>
    <body>
        <div class="contents p-1">
            <div class="m-1 text-center">
                QR Code scan sample
            </div>
            <button onclick="getCam()">Get Camera</button>
            <button onclick="startScan()">Scan</button>
            <button onclick="stop()">Stop</button>
            <div id="camSel" class="d-none"></div>
            <div id="reader" class=""></div>
            <div id="result"></div>
            <div id="log"></div>
        </div>
    </body>
    <script>
        var devices;
        var camId;
        const html5Qrcode = new Html5Qrcode("reader");

        function setCamSel(devices) {

        }

        function getCam() {
            Html5Qrcode.getCameras().then(devices => {
                if (devices && devices.length) {
                    $("#log").text("Success. Got: " + JSON.stringify(devices));
                    if (devices[1]) {
                        camId = devices[1].id;
                    } else {
                        camId = devices[0].id;
                    }
                }
            }).catch(err => {
                $("#log").text("Failed.");
            })
        }

        function startScan() {
            html5Qrcode.start(
                camId,
                {
                    fps: 2,
                    qrbox: 250
                },
                (decodedText, decodedResult) => {
                    console.log("Success");
                    $("#result").text(decodedText);
                },
                (errorMessage) => {})
            .catch((err) => {
                console.log(err);
            });
            $("#reader").removeClass("d-none");
        }

        function stop() {
            html5Qrcode.stop().then((ignore) => {
                console.log("stopped");
            }).catch((err) => {});
            $("#reader").addClass("d-none");
        }
    </script>
</html>